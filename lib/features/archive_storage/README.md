# Архивация и импорт хранилищ

## Описание
Реализован функционал для экспорта (архивации) и импорта (разархивации) хранилищ Hoplixi с поддержкой защиты паролем.

## Структура

### Сервисы
- **`archive_service.dart`** - Потоковая архивация/разархивация с использованием пакета `archive`
  - Обработка больших файлов через чанки без загрузки в память
  - Поддержка ZIP-архивов с паролем
  - Callback для отслеживания прогресса

### Провайдеры
- **`archive_provider.dart`** - Провайдер сервиса архивации
- **`archive_notifier.dart`** - Riverpod AsyncNotifier для управления состоянием экрана

### Модели
- **`archive_state.dart`** - Freezed модель состояния экрана
  - Список доступных хранилищ
  - Прогресс операций
  - Ошибки и успешные результаты

### UI
- **`archive_screen.dart`** - Главный экран с TabBar
- **`export_tab.dart`** - Вкладка экспорта
  - Выбор хранилища из списка
  - Выбор пути сохранения
  - Опциональный пароль
  - Прогресс-бар
- **`import_tab.dart`** - Вкладка импорта
  - Выбор файла архива
  - Опциональный пароль
  - Прогресс-бар

## Основные возможности

### Экспорт
1. Загружает список всех хранилищ из `AppPaths.appStoragePath`
2. Пользователь выбирает хранилище
3. Указывает путь для сохранения архива
4. Опционально устанавливает пароль
5. Архив создается потоково с отображением прогресса

### Импорт
1. Пользователь выбирает ZIP-файл
2. Опционально вводит пароль (если архив защищен)
3. Хранилище разархивируется в папку storages
4. Автоматически добавляется timestamp к имени папки
5. Список хранилищ обновляется после импорта

## Интеграция

### Роутинг
- Добавлен путь `/archive-store` в `AppRoutesPaths`
- Зарегистрирован роут в `routes.dart`
- Кнопка "Импорт/Экспорт" на главном экране активирована

### Потоковая обработка
- Используется `InputFileStream` и `OutputFileStream` для чтения/записи
- `ArchiveFile.stream()` для потокового добавления файлов
- `ZipDecoder.decodeStream()` для потоковой декодировки
- `writeContent()` с `freeMemory: true` для освобождения памяти

## Зависимости
- `archive: ^4.0.7` - Работа с ZIP-архивами
- `file_picker` - Выбор файлов и путей сохранения
- `result_dart` - Обработка результатов операций
- `freezed` - Генерация immutable моделей
- `riverpod` - Управление состоянием

## Использование

```dart
// Навигация на экран
context.push(AppRoutesPaths.archiveStore);

// Или из любого места через providerRef
ref.read(archiveNotifierProvider.notifier).exportStore();
ref.read(archiveNotifierProvider.notifier).importStore();
```

## Примечания
- Все операции выполняются асинхронно с отображением прогресса
- Ошибки обрабатываются через `DatabaseError` из `result_dart`
- Toast-уведомления об успехе/ошибке
- Память освобождается автоматически после операций
- Пароли не логируются
